/**
 * Created by Joaquim on 07/06/2015.
 */
function showPasswordRecoveryModal(){$(".profile-modal").modal("hide"),$(".password-recovery-modal").modal("show")}function showProfileModal(){$(".profile-modal").modal("show")}function showConfirmationModal(){$(".user-confirmation-modal").modal("show")}function showSignUpModal(){$(".sign-up-modal").modal("show")}function showSignInModal(){$(".sign-in-modal").modal("show")}function showSearchesModal(a){var b=$(".last-searches-modal"),c=$(".modal-body",b);c.empty(),$.get(a).done(function(a){var b=JSON.parse(a.searches);0==b.length?RequestException():b.forEach(function(a){var b=$("<div>").addClass("search-result").addClass("col-xs-12"),d=$("<a>").attr("href","#"),e=$("<p>").addClass("route").addClass("col-xs-12"),f=$("<span>").addClass("origin").addClass("col-xs-5").text(a.origin),g=$("<span>").addClass("glyphicon").addClass("glyphicon-arrow-right").addClass("col-xs-1").attr("aria-hidden","true"),h=$("<span>").addClass("destination").addClass("col-xs-5").text(a.destination),i=$("<p>").addClass("time"),j=$("<span>").addClass("glyphicon").addClass("glyphicon-time").attr("aria-hidden","true"),k=$("<span>").addClass("timestamp").text(a.created_at);e.append(f).append(g).append(h),i.append(j).append(k),d.append(e).append(i),b.append(d),c.append(b),d.on("click",function(){var b=$(".last-searches-modal");$("#origem").val($(this).find(".origin",b).text()),$("#destino").val($(this).find(".destination",b).text()),b.modal("hide"),calcRouteWithoutSave()})})}).fail(RequestException),$(".profile-modal").modal("hide"),b.modal("show")}function RequestException(){var a=$(".modal-body",".last-searches-modal"),b=$("<p>").text("Nenhuma pesquisa foi encontrada.").addClass("text-center").addClass("fail-text");b.appendTo(a)}function calcRoute(a){for(var b=0;b<markerArray.length;b++)markerArray[b].setMap(null);markerArray=[];var c=document.getElementById("origem"),d=document.getElementById("destino"),e={origin:c.value,destination:d.value,travelMode:google.maps.TravelMode.DRIVING};directionsService.route(e,function(b,c){c==google.maps.DirectionsStatus.OK&&(directionsDisplay.setDirections(b),calcTarifa(b.routes[0].legs[0].distance.text),displayTarifa(c),saveSearch(a,b.routes[0].legs[0].start_address,b.routes[0].legs[0].end_address))})}function calcRouteWithoutSave(){for(var a=0;a<markerArray.length;a++)markerArray[a].setMap(null);markerArray=[];var b=document.getElementById("origem"),c=document.getElementById("destino"),d={origin:b.value,destination:c.value,travelMode:google.maps.TravelMode.DRIVING};directionsService.route(d,function(a,b){b==google.maps.DirectionsStatus.OK&&(directionsDisplay.setDirections(a),calcTarifa(a.routes[0].legs[0].distance.text),displayTarifa(b))})}function calcTarifa(a){var b=5.2,c=2.05,d=2.46,e=25.83,f=parseInt(document.getElementById("hora-parada").value)+parseFloat(document.getElementById("minuto-parado").value/60),g=parseFloat(a.replace(".","").replace(",",".")),h=$("#check-hora-parada").is(":checked");document.getElementById("displayDistancia").innerHTML=a,h&&!isNaN(f)?(document.getElementById("displayBandeira1").innerHTML="R$ "+(b+g*c+e*f).toFixed(2).replace(".",","),document.getElementById("displayBandeira2").innerHTML="R$ "+(b+g*d+e*f).toFixed(2).replace(".",",")):(document.getElementById("displayBandeira1").innerHTML="R$ "+(b+g*c).toFixed(2).replace(".",","),document.getElementById("displayBandeira2").innerHTML="R$ "+(b+g*d).toFixed(2).replace(".",","))}function displayTarifa(a){a==google.maps.DirectionsStatus.OK?(erro.hide(),resultados.slideDown()):(resultados.hide(),erro.slideDown())}function initialize(){directionsService=new google.maps.DirectionsService;var a=new google.maps.LatLng(-22.8820913,-43.238735),b={zoom:12,center:a};map=new google.maps.Map(document.getElementById("map-canvas"),b);var c={map:map,draggable:!0};directionsDisplay=new google.maps.DirectionsRenderer(c);var d=document.getElementById("origem"),e=document.getElementById("destino");a=new google.maps.LatLngBounds(new google.maps.LatLng(-22.8820913,-43.238735),new google.maps.LatLng(-22.8820913,-43.238735));var f={bounds:a};autoCompleteOrigem=new google.maps.places.SearchBox(d,f),autoCompleteDestino=new google.maps.places.SearchBox(e,f),google.maps.event.addListener(directionsDisplay,"directions_changed",function(){var a=document.getElementById("origem"),b=document.getElementById("destino");a.value=directionsDisplay.getDirections().routes[0].legs[0].start_address,b.value=directionsDisplay.getDirections().routes[0].legs[0].end_address,calcTarifa(directionsDisplay.getDirections().routes[0].legs[0].distance.text)})}function reverseRoute(){var a=$("#origem"),b=$("#destino"),c=a.val();a.val(b.val()),b.val(c)}function saveSearch(a,b,c){var d={origin:b,destination:c};$.post(a,d,function(){console.log("Search saved.")}).fail(function(){console.log("Search not saved.")})}$(".profile-form-modal").on("submit",function(a){var b=$("#email-profile",$(this)),c=$("#name",$(this)),d=$("#password",$(this)),e=$("#password_confirmation",$(this)),f=""==b.val(),g=""==c.val(),h=""==d.val(),i=""==e.val();(f||g||h||i)&&(a.preventDefault(),f&&b.addClass("alert-danger"),g&&c.addClass("alert-danger"),h&&d.addClass("alert-danger"),i&&e.addClass("alert-danger"))}),$(".password-recovery-form-modal").on("submit",function(a){var b=$("#current-password",$(this)),c=$("#new-password",$(this)),d=$("#new-password_confirmation",$(this)),e=""==b.val(),f=""==c.val(),g=""==d.val();(e||f||g)&&(a.preventDefault(),e&&b.addClass("alert-danger"),f&&c.addClass("alert-danger"),g&&d.addClass("alert-danger"))}),$(".sign-in-form-modal").on("submit",function(a){var b=$("#email-sign-in",$(this)),c=$("#password-sign-in",$(this)),d=""==b.val(),e=""==c.val();(d||e)&&(a.preventDefault(),d&&b.addClass("alert-danger"),e&&c.addClass("alert-danger"))}),$(".sign-up-form-modal").on("submit",function(a){var b=$("#email",$(this)),c=$("#password",$(this)),d=$("#password_confirmation",$(this)),e=""==b.val(),f=""==c.val(),g=""==d.val();(e||f||g)&&(a.preventDefault(),e&&b.addClass("alert-danger"),f&&c.addClass("alert-danger"),g&&d.addClass("alert-danger"))}),$("#email-profile, #password, #password_confirmation, #name, #current-password, #new-password, #new-password_confirmation, #email-sign-in, #password-sign-in, #email, #password, #password_confirmation").on("blur",function(){""!=$(this).val()&&$(this).removeClass("alert-danger")}),$("#hora-parada, #minuto-parado").on("change",function(){$(this).val()<0&&$(this).val(0)}),$("#check-hora-parada").on("click",function(){$("#hora-parada").toggleClass("hidden"),$("#minuto-parado").toggleClass("hidden")}),$("[for=hora-parada]").on("click",function(){$("#hora-parada").toggleClass("hidden"),$("#minuto-parado").toggleClass("hidden"),$("#check-hora-parada")[0].checked=0==$("#check-hora-parada")[0].checked?!0:!1});var resultados=$("#resultados"),erro=$(".erro");resultados.hide(),erro.hide();var map,directionsDisplay,directionsService,markerArray=[];initialize();